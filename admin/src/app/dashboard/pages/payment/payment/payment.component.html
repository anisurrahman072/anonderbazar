<section>
    <nz-card class="card-height">
        <ng-template #title>
           {{currentUser.group_id==4? currentUser.username+"'s":""}} Financial History
        </ng-template>
        <ng-template #extra>
            <button *ngIf="'payment-create'|accessControl"
                    routerLink="/dashboard/payment/create" nz-button [nzType]="'primary'"
                    [nzSize]="'large'">
                <i class="anticon anticon-download"></i><span> Add New </span>
            </button>
        </ng-template>
        <ng-template #body>
            <nz-spin [nzSpinning]="_isSpinning">
                <nz-table #nzTable [nzDataSource]="data" [nzPageSize]="10"
                          [nzTotal]="total"
                          [nzIsPagination]="false"
                          
                          [nzSize]="'default'"
                          [nzShowTitle]="true">
                    
                    <thead nz-thead>
                    <tr>
                        <th nz-th>
                            <span> Customer Name </span>
                        </th>
                        <th nz-th>
                            <span> Order Id </span>
                        </th>
                        <th nz-th>
                            <span> Vendor Order Id </span>
                        </th>
                        <th nz-th>
                            <span> Vendor Name </span>
                        </th>
                        <th nz-th>
                            <span> Transaction ID</span>
                        </th>
                        <th nz-th>
                            <span> Payment type </span>
                        </th>
                        <th nz-th>
                            <span> Payment Amount </span>
                        </th>
                        <th nz-th>
                            <span> Payment Date </span>
                        </th>
                        <th nz-th>
                            <span> Status </span>
                        </th>
                        <th nz-th>

                        </th>
                    </tr>
                    </thead>
                    <thead nz-thead><!--search bar.....................-->
                    <tr>
                        <th nz-th>
                            <nz-input [nzPlaceHolder]="'Customer Search'" [(ngModel)]="nameSearchValue"
                                      (ngModelChange)="page=1;getPageData()">
                            </nz-input>
                        </th>
                        <th nz-th>
                            <nz-input [nzPlaceHolder]="'Order Id Search'" [(ngModel)]="orderNumberSearchValue"
                                      (ngModelChange)="page=1;getPageData()">
                            </nz-input>
                        </th>
                        <th nz-th>
                            <nz-input [nzPlaceHolder]="'Vendor Order Id Search'" [(ngModel)]="suborderNumberSearchValue"
                                      (ngModelChange)="page=1;getPageData()">
                            </nz-input>
                        </th>
                        <th nz-th>
                        </th>
                        <th nz-th>
                            <nz-input [nzPlaceHolder]="'Transaction ID Search'" [(ngModel)]="transactionSearchValue"
                                      (ngModelChange)="page=1;getPageData()">
                            </nz-input>
                        </th>
                        <th nz-th>
                            <nz-input [nzPlaceHolder]="'Payment type Search'" [(ngModel)]="paymentTypeSearchValue"
                                      (ngModelChange)="page=1;getPageData()">
                            </nz-input>
                        </th>
                        <th nz-th>
                            <nz-input [nzPlaceHolder]="'Payment Amount Search'" [(ngModel)]="paymentAmountSearchValue"
                                      (ngModelChange)="page=1;getPageData()">
                            </nz-input>
                        </th>
                        <th nz-th>
                            <nz-input [nzPlaceHolder]="'Payment Date Search'" [(ngModel)]="dateSearchValue"
                                      (ngModelChange)="page=1;getPageData()">
                            </nz-input>
                        </th>
                        <th nz-th>
                            <span *ngIf="setStatus(i, data.status)"></span>
                            <nz-select style="width: 180px;"
                                       [nzFilter]="true"
                                       [(ngModel)]="statusSearchValue"
                                       nzAllowClear
                                       (ngModelChange)="page=1;getPageData()"
                                       [nzPlaceHolder]="'Select Status'"
                                       [nzNotFoundContent]="'Not found'">
                                <nz-option
                                        *ngFor="let option of options"
                                        [nzLabel]="option.label"
                                        [nzValue]="option.value">
                                    <ng-template #nzOptionTemplate>
                                        <i class="anticon " [ngClass]="option.icon"></i>
                                        {{option.label}}
                                    </ng-template>
                                </nz-option>
                            </nz-select>
                        </th>
                        <th nz-th>
                        </th>
                    </tr>
                    </thead>
                    <tbody nz-tbody>
                    <tr nz-tbody-tr *ngFor="let data of nzTable.data">
                        <td nz-td>{{data.user_id.first_name}} {{data.user_id.last_name}}</td>
                        <td nz-td>{{data.order_id?.id}}</td>
                        <td nz-td>{{data.suborder_id?.id}}</td>
                        <td nz-td>{{data.receiver_id?.username || 'n/a'}}</td>
                        <td nz-td>{{data.transection_key}}</td>
                        <td nz-td>{{data.payment_type}}</td>
                        <td nz-td>{{data.payment_amount }}</td>
                        <td nz-td>{{(data.payment_date|date) || 'n/a'}}</td>

                        <td nz-td>
                            <span *ngIf="setStatus(i,data.id, data.status)"></span>
                            <nz-select style="width: 180px;" [(ngModel)]="selectedOption[i]"
                                       [nzPlaceHolder]="'choose option'">
                                <nz-option
                                        *ngFor="let option of options"
                                        [nzLabel]="option.label"
                                        [nzValue]="option.value">
                                    <ng-template #nzOptionTemplate>
                                        <i class="anticon " [ngClass]="option.icon"></i>
                                        {{option.label}}
                                    </ng-template>
                                </nz-option>
                            </nz-select>
                            <nz-popconfirm [nzTitle]="'Are you sure want to change status ï¼Ÿ'" [nzOkText]="'ok'"
                                           [nzCancelText]="'cancel'"
                                           (nzOnConfirm)="changeStatusConfirm(i,data.id,data.status)">
                                <a nz-popconfirm *ngIf="selectedOption[i]!=data.status">
                                    <button nz-button [nzType]="'danger'" [nzSize]="'default'">
                                        <i class="anticon anticon-edit"> Save </i>
                                    </button>
                                </a>
                            </nz-popconfirm>
                        </td>

                        <td>
                            <button *ngIf="'payment-read'|accessControl"
                                    [routerLink]="['/dashboard/payment/details/', data.id]" nz-button [nzType]="'info'"
                                    [nzSize]="'default'">
                                <i class="anticon anticon-info-circle">  </i>
                            </button>
                            <button *ngIf="'payment-edit'|accessControl"
                                    [routerLink]="['/dashboard/payment/edit', data.id]" nz-button [nzType]="'primary'"
                                    [nzSize]="'default'">
                                <i class="anticon anticon-edit">  </i>
                            </button>
                            <ng-container *ngIf="'payment-delete'|accessControl">
                                <nz-popconfirm [nzTitle]="'Are you sure you want to delete?'"
                                               [nzOkText]="'Delete'"
                                               [nzCancelText]="'Cancel'"
                                               (nzOnConfirm)="deleteConfirm(data.id)">
                                    <a nz-popconfirm>
                                        <button nz-button [nzType]="'danger'" [nzSize]="'default'">
                                            <i class="anticon anticon-delete">  </i>
                                        </button>
                                    </a>
                                </nz-popconfirm>
                            </ng-container>
                        </td>
                    </tr>
                    </tbody>
                </nz-table>
            </nz-spin>
            <div class="row">
                    <div class="col-md-offset-5" style="margin-top: 10px">
                        <span nz-table-title class="col-md-6">
                            <nz-pagination (nzPageIndexClickChange)="changePage($event,limit)"
                                            (nzPageSizeChange)="changePage(1,$event)"
                                            nzShowTotal [nzPageIndex]="page" [nzTotal]="total" nzShowSizeChanger
                                            [nzPageSize]="limit">
                            </nz-pagination>
                        </span>
                        <span nz-table-title class="pull-right col-md-6">
                                <button nz-button (click)="resetAllFilter()">Clear filter</button>
                            </span>
                    </div>
                    </div>
        </ng-template>
    </nz-card>
</section>
